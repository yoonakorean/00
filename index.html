<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>挑戰賽排行榜與成績</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body { 
    font-family: sans-serif; 
    max-width: 800px; 
    margin: 30px auto; 
    text-align: center; 
    padding: 0 10px; 
  }
  #logo { 
    width: 150px; 
    margin-bottom: 20px; 
  }
  table { 
    width: 100%; 
    border-collapse: collapse; 
    margin-top: 20px; 
  }
  th, td { 
    border: 1px solid #ccc; 
    padding: 10px; 
    text-align: center; 
  }
  th { 
    background: #f2f2f2; 
  }
  .highlight { 
    background: #fffae6; 
    font-weight: bold; 
  }
  .medal {
    width: 40px;   /* 放大獎牌 */
    height: auto;
    vertical-align: middle;
    margin-right: 6px;
  }
</style>
</head>
<body>
  <img id="logo" src="https://yoonakorean.github.io/logo.png" alt="Logo" />
  <h2>挑戰賽排行榜</h2>
  <table id="rankingTable">
    <thead>
      <tr>
        <th>排名</th>
        <th>名稱</th>
        <th>分數</th>
        <th>總秒數</th>
        <th>平均秒數</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const medalIcons = {
  1: "https://cdn-icons-png.flaticon.com/512/2583/2583346.png", // 金牌
  2: "https://cdn-icons-png.flaticon.com/512/2583/2583364.png", // 銀牌
  3: "https://cdn-icons-png.flaticon.com/512/2583/2583399.png"  // 銅牌
};

fetch("https://api.sheetbest.com/sheets/6609511a-f588-4e32-b708-21ff2db40d2b")
  .then(res => res.json())
  .then(data => {
    // 排序：先比分數，再比平均秒數（小的在前）
    data.sort((a, b) => {
      if (b.score != a.score) return b.score - a.score;
      return (a.time / a.units) - (b.time / b.units);
    });

    const tbody = document.querySelector("#rankingTable tbody");
    data.forEach((row, index) => {
      const tr = document.createElement("tr");

      // 排名或獎牌
      const rankCell = document.createElement("td");
      if (medalIcons[index+1]) {
        rankCell.innerHTML = `<img src="${medalIcons[index+1]}" class="medal">`;
      } else {
        rankCell.textContent = index + 1;
      }
      tr.appendChild(rankCell);

      // 名稱
      const nameCell = document.createElement("td");
      nameCell.textContent = row.nickname;
      tr.appendChild(nameCell);

      // 分數
      const scoreCell = document.createElement("td");
      scoreCell.textContent = row.score;
      tr.appendChild(scoreCell);

      // 總秒數
      const totalCell = document.createElement("td");
      totalCell.textContent = row.time;
      tr.appendChild(totalCell);

      // 平均秒數 = 總秒數 ÷ 單元數
      const avgCell = document.createElement("td");
      const units = parseInt(row.units) || 1;
      avgCell.textContent = (row.time / units).toFixed(2);
      tr.appendChild(avgCell);

      tbody.appendChild(tr);
    });
  });
</script>
</body>
</html>
